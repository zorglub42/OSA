var logSearch_userName="",logSearch_serviceName="",logSearch_status="",logSearch_message="",logSearch_from="",logSearch_until="",logSearch_frontEndEndPoint="",logRowPattern=null,nextFetch="",previousFetch="",fetchingMore=0;function resetSearchLogs(){logSearch_frontEndEndPoint=logSearch_until=logSearch_from=logSearch_message=logSearch_status=logSearch_serviceName=logSearch_userName="";searchLogs()}
function generateLogsTableRows(a){table=document.getElementById("data");null==logRowPattern&&(logRowPattern=document.getElementById("rowTpl"),table.removeChild(logRowPattern));for(i=0;i<a.length;i++)D=new Date,D.setISO8601(a[i].timeStamp),timeStamp=D.format("mm/dd/yyyy HH:MM:ss"),newRow=logRowPattern.cloneNode(!0),newRow.removeAttribute("id"),newRow.removeAttribute("style"),newRow.className="tabular_table_body"+i%2+" "+newRow.className,newRow.innerHTML=newRow.innerHTML.replaceAll("{logsList[i].serviceName}",
a[i].serviceName).replaceAll("{logsList[i].userName}",a[i].userName).replaceAll("{logsList[i].frontEndUri}",a[i].frontEndUri).replaceAll("{logsList[i].status}",a[i].status).replaceAll("{logsList[i].message}",a[i].message).replaceAll("{timeStamp}",timeStamp),table.appendChild(newRow)}
function displayLogsList(a){$.get("resources/templates/logList.php",function(b){$("#content").html(b.replaceAll("{logsList.length}",a.length));logRowPattern=null;0<a.logs.length?(nextFetch=a.next,previousFetch=a.previous,generateLogsTableRows(a.logs)):($("#logsList").hide(),previousFetch=nextFetch="");fetchingMore=0;nextFetch=a.next;previousFetch=a.previous;hideWait();$("#data").scroll(function(){var a=$(".item:last"),b=$("#data");console.log("Fetch");b.offset().top+b.height()-a.height()>a.offset().top&&
0==fetchingMore&&""!=nextFetch&&(fetchingMore=1,showWait(),$.ajax({url:nextFetch,dataType:"json",type:"GET",success:addFetch,error:displayError}))});touchScroll("data")})}function addFetch(a){hideWait();fetchingMore=0;nextFetch=a.next;previousFetch=a.previous;$("#logsCount").html(a.length+" hits found");generateLogsTableRows(a.logs)}function startPopulateAutoCompleteServices(){$.getJSON("services/?withLog=&order=serviceName",populatePopulateAutoCompleteServices).error(displayError)}
function startPopulateAutoCompleteUsers(){$.getJSON("users/?withLog=&order=userName",populatePopulateAutoCompleteUsers).error(displayError)}function populatePopulateAutoCompleteServices(a){var b=[],c=0;for(i=0;i<a.length;i++)1==a[i].isHitLoggingEnabled&&(b[c++]=a[i].serviceName);$("#serviceName").autocomplete({source:b,minLength:0})}function populatePopulateAutoCompleteUsers(a){var b=["None"];for(i=0;i<a.length;i++)b[i+1]=a[i].userName;$("#userName").autocomplete({source:b,minLength:0})}
function startSearchLogs(){logSearch_userName=document.getElementById("userName").value;logSearch_serviceName=document.getElementById("serviceName").value;logSearch_status=document.getElementById("httpStatus").value;logSearch_message=document.getElementById("message").value;logSearch_frontEndEndPoint=document.getElementById("frontEndEndPoint").value;logSearch_from=document.getElementById("from").value;logSearch_until=document.getElementById("until").value;executeSearchLog()}
function executeSearchLog(){queryString="";""!=logSearch_serviceName&&(queryString+="serviceName="+encodeURIComponent(logSearch_serviceName)+"&");""!=logSearch_userName&&(""!=queryString&&(queryString+="&"),queryString="None"==logSearch_userName?queryString+"userName=":queryString+("userName="+encodeURIComponent(logSearch_userName)));""!=logSearch_frontEndEndPoint&&(""!=queryString&&(queryString+="&"),queryString+="frontEndEndPoint="+encodeURIComponent(logSearch_frontEndEndPoint));""!=logSearch_status&&
(""!=queryString&&(queryString+="&"),queryString+="status="+encodeURIComponent(logSearch_status));""!=logSearch_message&&(""!=queryString&&(queryString+="&"),queryString+="message="+encodeURIComponent(logSearch_message));""!=logSearch_from&&(""!=queryString&&(queryString+="&"),D=new Date(logSearch_from+":00"),queryString+="from="+encodeURIComponent(D.format("isoUtcDateTime")));""!=logSearch_until&&(""!=queryString&&(queryString+="&"),D=new Date(logSearch_until+":00"),queryString+="until="+encodeURIComponent(D.format("isoUtcDateTime")));
go=!0;""==queryString&&(go=confirm("<?php echo Localization::getJSString("log.execute.confirm")?>"));go&&(""!=queryString&&(queryString+="&"),queryString+="order="+encodeURIComponent("timeStamp desc"),showWait(),$.ajax({url:"logs/?"+queryString,dataType:"json",type:"GET",success:displayLogsList,error:displayError}))}
function searchLogs(){$.get("resources/templates/logSearch.php",function(a){$("#content").html(a.replaceAll("{logSearch_serviceName}",logSearch_serviceName).replaceAll("{logSearch_userName}",logSearch_userName).replaceAll("{logSearch_frontEndEndPoint}",logSearch_frontEndEndPoint).replaceAll("{logSearch_status}",logSearch_status).replaceAll("{logSearch_message}",logSearch_message).replaceAll("{logSearch_from}",logSearch_from).replaceAll("{logSearch_until}",logSearch_until));startPopulateAutoCompleteServices();
startPopulateAutoCompleteUsers();$("#from").datetimepicker();$("#until").datetimepicker()})}$(function(){$("#searchLogs").click(searchLogs)});
