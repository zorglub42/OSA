ZZOPEN;ZZCLOSE;var currentNode,nodeModified,removeSSLSetting=!1,removeCASSLSetting=!1,servicesLoaded=!1,nodeNameFilterPrevVal="",nodeDescriptionFilterPrevVal="",localIPFilterPrevVal="",portFilterPrevVal="",serverFQDNFilterPrevVal="";
function setNodeModified(a){(nodeModified=a)?setActionButtonEnabled("saveNode",!0):setActionButtonEnabled("saveNode",!1);$("#isHTTPS").is(":checked")?$("#tabs").tabs("enable",1):$("#tabs").tabs("disable",1);""!=$("#additionalConfiguration").val()?$("#warnAdditionalConfig").show():$("#warnAdditionalConfig").hide()}function startEditNode(a){$.getJSON(a,editNode).error(displayErrorV2)}function updateNode(a){delCerts()}
function startResetCASSL(){confirm("ZZOPEN echo Localization::getJSString(QUOTEnode.deleteCASSL.confirmQUOTE)ZZCLOSE")&&(removeCASSLSetting=!0,setNodeModified(!0),clearFileInput("CHAINfileuploadFLD"))}function startResetSSL(){confirm("ZZOPEN echo Localization::getJSString(QUOTEnode.deleteSSL.confirmQUOTE)ZZCLOSE")&&(removeSSLSetting=!0,setNodeModified(!0),clearFileInput("PKfileuploadFLD"),clearFileInput("CERTfileuploadFLD"))}
function loadNodeServices(a){servicesLoaded||(showWait(),$.getJSON(a+"/services/",displayNodeServices).error(displayErrorV2))}
function displayNodeServices(a){hideWait();table=document.getElementById("data");rowPattern=document.getElementById("rowTpl");table.removeChild(rowPattern);$("#serviceListTitle").html($("#serviceListTitle").html().replaceAll("{serviceList.length}",a.length));for(i=0;i<a.length;i++)cbPublishedCheck=1==a[i].isPublished?"checked":"",newRow=rowPattern.cloneNode(!0),newRow.removeAttribute("id"),newRow.removeAttribute("style"),newRow.className=newRow.className+" tabular_table_body"+i%2,newRow.innerHTML=
newRow.innerHTML.replaceAll("{serviceList[i].serviceName}",a[i].serviceName).replaceAll("{servicelist[i].cbpublishedcheck}",cbPublishedCheck).replaceAll("{i}",i).replaceAll("{serviceList[i].groupName}",a[i].groupName).replaceAll("{serviceList[i].frontEndEndPoint}",a[i].frontEndEndPoint).replaceAll("{serviceList[i].backEndEndPoint}",a[i].backEndEndPoint),table.appendChild(newRow);0==a.length&&$("#servicesList").hide();servicesLoaded=!0}
function clearFileInput(a){a=document.getElementById(a);var b=document.createElement("input");b.type="file";b.id=a.id;b.name=a.name;b.className=a.className;b.style.cssText=a.style.cssText;a.parentNode.replaceChild(b,a)}function toggleAuthority(){$("#sslAuthority").toggle();$("#manageCaCert").is(":checked")||clearFileInput("CHAINfileuploadFLD")}
function editNode(a){$.get("resources/templates/nodeEdit.php",function(b){servicesLoaded=!1;cbIsHTTPS="checked";cbManageCAEnabled="";0==a.isHTTPS&&(cbIsHTTPS="");if(""!=a.caUri||""!=a.chainUri)cbManageCAEnabled="checked";currentNode=a;$("#content").html(b.replaceAll("{node.uri}",a.uri).replaceAll("{node.additionalConfiguration}",a.additionalConfiguration).replaceAll("{nodeNameAsLabel}",a.nodeName).replaceAll("{nodeNameInputType}","hidden").replaceAll("{node.nodeName}",a.nodeName).replaceAll("{cbIsHTTPS}",
cbIsHTTPS).replaceAll("{node.localIP}",a.localIP).replaceAll("{node.port}",a.port).replaceAll("{node.serverFQDN}",a.serverFQDN).replaceAll("{node.nodeDescription}",a.nodeDescription).replaceAll("{cbManageCAEnabled}",cbManageCAEnabled));""==a.caUri&&""==a.chainUri&&$("#sslAuthority").hide();$(function(){$("#tabs").tabs()});$("#mainForm").height($("#tabs").height()+10);$("#mainForm").click(function(){$("#mainForm").height($("#tabs").height()+10)});setNodeModified(!1);removeCASSLSetting=removeSSLSetting=
!1})}
function saveOrUpdateNodeBase(a,b,c){if("80"==$("#port").val()&&document.getElementById("isHTTPS").checked&&!confirm("ZZOPEN echo Localization::getJSString(QUOTEnode.https-on-80-warningQUOTE)ZZCLOSE")||"443"==$("#port").val()&&!document.getElementById("isHTTPS").checked&&!confirm("ZZOPEN echo Localization::getJSString(QUOTEnode.http-on-443-warningQUOTE)ZZCLOSE"))return!1;showWait();nodeName="nodeName="+encodeURIComponent($("#nodeNameFld").val());localIP="localIP="+encodeURIComponent(document.getElementById("localIP").value);port=
"port="+encodeURIComponent(document.getElementById("port").value);nodeDescription="nodeDescription="+encodeURIComponent(document.getElementById("nodeDescription").value);additionalConfiguration="additionalConfiguration="+encodeURIComponent($("#additionalConfiguration").val());serverFQDN="serverFQDN="+encodeURIComponent(document.getElementById("serverFQDN").value);isHTTPS=document.getElementById("isHTTPS").checked?"isHTTPS=1":"isHTTPS=0";postData=localIP+"&"+serverFQDN+"&"+port+"&"+nodeDescription+
"&"+additionalConfiguration+"&"+isHTTPS;"PUT"==a?businessUrl="nodes/"+encodeURIComponent(document.getElementById("nodeNameFld").value):(businessUrl="nodes/",postData="nodeName="+encodeURIComponent(document.getElementById("nodeNameFld").value)+"&"+postData);applyComp=c?"":"&apply=0";$.ajax({url:businessUrl,dataType:"json",type:a,data:postData+applyComp,success:b,error:displayErrorV2})}
function delCerts(){promises=[];var a=document.getElementById("PKfileuploadFLD"),b=document.getElementById("CERTfileuploadFLD"),c=document.getElementById("CHAINfileuploadFLD");showWait();removeSSLSetting&&0==a.files.length&&0==b.files.length&&(cert=new Promise(function(a,b){$.ajax({url:"nodes/"+currentNode.nodeName+"/cert",dataType:"json",async:!1,type:"DELETE",success:a,error:b})}),promises.push[cert],key=new Promise(function(a,b){$.ajax({url:"nodes/"+currentNode.nodeName+"/privateKey",dataType:"json",
type:"DELETE",async:!1,success:a,error:b})}),promises.push(key));removeCASSLSetting&&0==c.files.length&&(chain=new Promise(function(a,b){$.ajax({url:"nodes/"+currentNode.nodeName+"/chain",dataType:"json",type:"DELETE",async:!1,success:a,error:b})}));promises.length?Promise.all(promises).then(function(a){uploadCerts()})["catch"](function(a){displayErrorV2(a)}):uploadCerts()}
function uploadCerts(){var a=document.getElementById("PKfileuploadFLD"),b=document.getElementById("CERTfileuploadFLD"),c=document.getElementById("CHAINfileuploadFLD");nodeURI="nodes/"+encodeURIComponent(document.getElementById("nodeNameFld").value);promises=[];0<a.files.length&&(key=new Promise(function(b,c){$("#fileuploadKEY").fileupload();jqxhr=$("#fileuploadKEY").fileupload("send",{files:a.files,url:nodeURI+"/privateKey"}).error(function(a,b,d){$("#fileuploadKEY").fileupload("destroy");c(a)}).complete(function(a,
c,e){$("#fileuploadKEY").fileupload("destroy");b(!0)})}),promises.push(key));0<b.files.length&&(cert=new Promise(function(a,c){$("#fileuploadPEM").fileupload();jqxhr=$("#fileuploadPEM").fileupload("send",{files:b.files,url:nodeURI+"/cert"}).error(function(a,b,d){$("#fileuploadPEM").fileupload("destroy");c(a)}).complete(function(){$("#fileuploadPEM").fileupload("destroy");a(!0)})}),promises.push(cert));0<c.files.length&&(chain=new Promise(function(a,b){$("#fileuploadCHAIN").fileupload();jqxhr=$("#fileuploadCHAIN").fileupload("send",
{files:c.files,url:nodeURI+"/chain"}).error(function(a,c,d){$("#fileuploadCHAIN").fileupload("destroy");b(a)}).complete(function(){$("#fileuploadCHAIN").fileupload("destroy");a(!0)})}),promises.push(chain));0<promises.length?Promise.all(promises).then(function(a){saveOrUpdateNodeBase("PUT",showNodes,!0)})["catch"](function(a){displayErrorV2(a)}):saveOrUpdateNodeBase("PUT",showNodes,!0)}
function saveNewNode(){document.getElementById("CERTfileuploadFLD");var a=document.getElementById("PKfileuploadFLD");document.getElementById("CHAINfileuploadFLD");0<a.files.length&&0<a.length||0<a.files.length?saveOrUpdateNodeBase("POST",updateNode,!1):saveOrUpdateNodeBase("POST",showNodes,!0)}
function addNode(){$.get("resources/templates/nodeAdd.php",function(a){currentNode=null;$("#content").html(a.replaceAll("{node.uri}","").replaceAll("{node.additionalConfiguration}","").replaceAll("{nodeNameAsLabel}","").replaceAll("{nodeNameInputType}","text").replaceAll("{node.nodeName}","").replaceAll("{cbIsHTTPS}","").replaceAll("{node.localIP}","").replaceAll("{node.port}","").replaceAll("{node.serverFQDN}","").replaceAll("{node.nodeDescription}","").replaceAll("{cbManageCAEnabled}","").replaceAll("{lblChain}",
""));$("#sslAuthority").hide();$("#showServices").hide();$("#resetSSL").hide();$("#resetCASSL").hide();$(function(){$("#tabs").tabs()});$("#mainForm").height($("#tabs").height()+10);$("#mainForm").click(function(){$("#mainForm").height($("#tabs").height()+10)});setNodeModified(!1);removeCASSLSetting=removeSSLSetting=!1})}function handelNodeFilterFormKeypress(a){if(13==a.keyCode)return showNodes(),!1}
function displayNodeList(a){hideWait();$.get("resources/templates/nodeList.php",function(b){$("#content").html(b.replaceAll("{nodeList.length}",a.length).replaceAll("{nodeNameFilterPrevVal}",nodeNameFilterPrevVal).replaceAll("{nodeDescriptionFilterPrevVal}",nodeDescriptionFilterPrevVal).replaceAll("{serverFQDNFilterPrevVal}",serverFQDNFilterPrevVal).replaceAll("{localIPFilterPrevVal}",localIPFilterPrevVal).replaceAll("{portFilterPrevVal}",portFilterPrevVal));table=document.getElementById("data");
rowPattern=document.getElementById("rowTpl");table.removeChild(rowPattern);b=[];var c=[],d=[],e=[],f=[];for(i=0;i<a.length;i++)cbIsHTTPS=1==a[i].isHTTPS?"checked":"",addItem(b,a[i].nodeName),addItem(c,a[i].nodeDescription,!0),addItem(d,a[i].serverFQDN,!0),addItem(e,a[i].localIP,!0),addItem(f,a[i].port.toString(),!0),newRow=rowPattern.cloneNode(!0),newRow.removeAttribute("id"),newRow.removeAttribute("style"),newRow.className=newRow.className+" tabular_table_body"+i%2,newRow.innerHTML=newRow.innerHTML.replaceAll("{nodeList[i].nodeName}",
a[i].nodeName).replaceAll("{rowParity}",i%2).replaceAll("{i}",i).replaceAll("{cbishttps}",cbIsHTTPS).replaceAll("{nodeList[i].serverFQDN}",a[i].serverFQDN).replaceAll("{nodeList[i].localIP}",a[i].localIP).replaceAll("{nodeList[i].port}",a[i].port).replaceAll("{nodeList[i].nodeDescription}",a[i].nodeDescription).replaceAll("{nodeList[i].uri}",a[i].uri),table.appendChild(newRow),edit=document.getElementById("btnEdit"),del=document.getElementById("btnDelete"),del.removeAttribute("id"),edit.removeAttribute("id"),
publish=document.getElementById("btnPublish"),unpublish=document.getElementById("btnUnpublish"),1==a[i].isPublished?(publish.remove(),unpublish.removeAttribute("id")):(unpublish.remove(),publish.removeAttribute("id"));$("#nodeNameFilter").autocomplete({source:b,minLength:0});$("#nodeDescriptionFilter").autocomplete({source:c,minLength:0});$("#serverFQDNFilter").autocomplete({source:d,minLength:0});$("#localIPFilter").autocomplete({source:e,minLength:0});$("#portFilter").autocomplete({source:f,minLength:0})})}
function deleteNode(a,b){confirm("ZZOPEN echo Localization::getJSString(QUOTEnode.delete.confirmQUOTE)ZZCLOSE "+b+"?")&&(showWait(),$.ajax({url:a,dataType:"json",type:"DELETE",success:showNodes,error:displayErrorV2}))}function publishNode(a,b){showWait();$.ajax({url:a+"/status",dataType:"json",type:"POST",data:"published="+b,success:showNodes,error:displayErrorV2})}
function resetNodeFilter(){$("#nodeNameFilter").val("");$("#nodeDescriptionFilter").val("");$("#localIPFilter").val("");$("#portFilter").val("");$("#serverFQDNFilter").val("");showNodes()}
function showNodes(){prms="order=nodeName";prms=prms+"&nodeNameFilter="+encodeURIComponent(getFilterValue("nodeNameFilter"));prms=prms+"&nodeDescriptionFilter="+encodeURIComponent(getFilterValue("nodeDescriptionFilter"));prms=prms+"&localIPFilter="+encodeURIComponent(getFilterValue("localIPFilter"));""!=getFilterValue("portFilter")&&(prms=prms+"&portFilter="+encodeURIComponent(getFilterValue("portFilter")));prms=prms+"&serverFQDNFilter="+encodeURIComponent(getFilterValue("serverFQDNFilter"));$.ajax({url:"./nodes/",
dataType:"json",type:"GET",data:prms,success:displayNodeList,error:displayErrorV2})}$(function(){$("#listNode").click(resetNodeFilter);$("#addNode").click(addNode)});
