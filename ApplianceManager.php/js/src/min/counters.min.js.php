var currentCounter,counterModified,counterSearch_resourceName,counterSearch_userName,counterSearch_timeUnit,currentCounterList,backList;function setCounterModified(a){(counterModified=a)?setActionButtonEnabled("save",!0):setActionButtonEnabled("save",!1)}function updateCounter(a){saveOrUpdateCounter("PUT")}
function saveOrUpdateCounter(a){value="value="+encodeURIComponent(document.getElementById("counterValue").value);$.ajax({url:currentCounterUri,dataType:"json",type:a,data:value,success:editCurrentCounter,error:displayErrorV2})}function startEditCounter(a){currentCounterUri=currentCounterList[a].uri;editCurrentCounter()}function editCurrentCounter(){$.getJSON(currentCounterUri,editCounter).error(displayErrorV2)}
function editCounter(a){$.get("resources/templates/counterEdit.php",function(b){$("#content").html(b.replaceAll("{counter.resourceName}",a.resourceName).replaceAll("{counter.userName}",a.userName).replaceAll("{counter.timeUnit}",a.timeUnit).replaceAll("{counter.timeValue}",a.timeValue).replaceAll("{counter.value}",a.value).replaceAll("{counter.uri}",a.uri));currentCounter=a;currentCounterUi=a.uri;setCounterModified(!1)})}
function displayCounterList(a){$.get("resources/templates/counterList.php",function(b){$("#content").html(b.replaceAll("{counterList.length}",a.length));table=document.getElementById("data");rowPattern=document.getElementById("rowTpl");table.removeChild(rowPattern);for(i=0;i<a.length;i++)newRow=rowPattern.cloneNode(!0),newRow.removeAttribute("id"),newRow.removeAttribute("style"),newRow.className=newRow.className+" tabular_table_body"+i%2,newRow.innerHTML=newRow.innerHTML.replaceAll("{counterList[i].resourceName}",
a[i].resourceName).replaceAll("{counterList[i].userName}",a[i].userName).replaceAll("{counterList[i].timeUnit}",a[i].timeUnit).replaceAll("{counterList[i].timeValue}",a[i].timeValue).replaceAll("{counterList[i].value}",a[i].value).replaceAll("{rowParity}",i%2).replaceAll("{i}",i),table.appendChild(newRow),edit=document.getElementById("btnEdit"),del=document.getElementById("btnDelete"),del.removeAttribute("id"),edit.removeAttribute("id");0<a.length?(currentCounterList=a,backList=executeSearch):$("#countersList").hide()})}
function resetExceededCountersFilter(){$("#serviceNameFilter").val("");$("#userNameFilter").val("");searchExcedeedCounters()}
function displayExcedeedCounterList(a){$.get("resources/templates/counterExceededList.php",function(b){$("#content").html(b.replaceAll("{counterList.length}",a.length).replaceAll("{serviceNameFilterPrevVal}",serviceNameFilterPrevVal).replaceAll("{userNameFilterPrevVal}",userNameFilterPrevVal));table=document.getElementById("data");rowPattern=document.getElementById("rowTpl");table.removeChild(rowPattern);for(i=0;i<a.length;i++)newRow=rowPattern.cloneNode(!0),newRow.removeAttribute("id"),newRow.removeAttribute("style"),
newRow.className=newRow.className+" tabular_table_body"+i%2,newRow.innerHTML=newRow.innerHTML.replaceAll("{counterList[i].resourceName}",a[i].resourceName).replaceAll("{counterList[i].userName}",a[i].userName).replaceAll("{counterList[i].timeUnit}",a[i].timeUnit).replaceAll("{counterList[i].timeValue}",a[i].timeValue).replaceAll("{counterList[i].value}",a[i].value).replaceAll("{counterList[i].maxValue}",a[i].maxValue).replaceAll("{rowParity}",i%2).replaceAll("{i}",i),table.appendChild(newRow),edit=
document.getElementById("btnEdit"),del=document.getElementById("btnDelete"),del.removeAttribute("id"),edit.removeAttribute("id");0<a.length?(currentCounterList=a,backList=searchExcedeedCounters):$("#countersList").hide()})}function deleteCounter(a){confirm("<?php echo Localization::getJSString("counter.delete.confirm")?>")&&$.ajax({url:currentCounterList[a].uri,dataType:"json",type:"DELETE",success:backList,error:displayErrorV2})}
function showCounters(){$.getJSON("./counters/?order=counterName",displayCounterList).error(displayErrorV2)}function startPopulateServices(){$.getJSON("services/?withQuotas=1&order=serviceName",populateServices).error(displayErrorV2)}function startPopulateUsers(){$.getJSON("users/?order=userName",populateUsers).error(displayErrorV2)}
function populateServices(a){if(0<a.length){var b=[],c=0;for(i=0;i<a.length;i++)1==a[i].isHitLoggingEnabled&&(b[c++]=a[i].serviceName);$("#resourceName").autocomplete({source:b,minLength:0})}}function populateUsers(a){if(0<a.length){var b=[],c=0;b[c++]="*** Any ***";for(i=0;i<a.length;i++)b[c++]=a[i].userName;$("#userName").autocomplete({source:b,minLength:0})}}
function startSearchCounters(){counterSearch_userName=document.getElementById("userName").value;counterSearch_resourceName=document.getElementById("resourceName").value;counterSearch_timeUnit=document.getElementById("timeUnit").value;executeSearch()}function handelExcedeedCountersFilterFormKeypress(a){if(13==a.keyCode)return searchExcedeedCounters(),!1}
function searchExcedeedCounters(){prms="";prms=prms+"userNameFilter="+encodeURIComponent(getFilterValue("userNameFilter"));prms=prms+"&resourceNameFilter="+encodeURIComponent(getFilterValue("serviceNameFilter"));$.ajax({url:"counters/excedeed/",dataType:"json",type:"GET",data:prms,success:displayExcedeedCounterList,error:displayErrorV2})}
function executeSearch(){queryString="";"All"!=counterSearch_resourceName&&(queryString+="resourceName="+encodeURIComponent(counterSearch_resourceName)+"&");"None"==counterSearch_userName?queryString+="userName=":"All"!=counterSearch_userName&&(queryString+="userName="+encodeURIComponent(counterSearch_userName));"All"!=counterSearch_timeUnit&&(""!=queryString&&(queryString+="&"),queryString+="timeUnit="+encodeURIComponent(counterSearch_timeUnit));$.ajax({url:"counters/?"+queryString,dataType:"json",
type:"GET",success:displayCounterList,error:displayErrorV2})}function searchCounters(){$.get("resources/templates/counterSearch.php",function(a){$("#content").html(a);startPopulateServices();startPopulateUsers()})}$(function(){$("#searchCounter").click(searchCounters);$("#searchExcedeedCounters").click(searchExcedeedCounters)});
