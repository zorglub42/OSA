ZZOPEN;ZZCLOSE;var currentUserURI,currentUser,userModified,propertiesCount,editQuota="Edit this quota",deleteQuota="Delete this quota",userNameFilterPrevVal="",firstNameFilterPrevVal="",lastNameFilterPrevVal="",emailAddressFilterPrevVal="",entityFilterPrevVal="";
function deleteUserQuotas(a,b){confirm("ZZOPEN echo Localization::getJSString(QUOTEuser.deleteQuota.confirmQUOTE)ZZCLOSE "+b+"?")&&$.ajax({url:a,dataType:"json",type:"DELETE",success:startDisplayUserQuotasForCurrentUser,error:displayErrorV2})}
function setUserModified(a){(userModified=a)?($("#cancel").html("ZZOPEN echo Localization::getJSString(QUOTEbutton.cancelQUOTE)ZZCLOSE"),setActionButtonEnabled("saveNew",!0),setActionButtonEnabled("saveEdit",!0),setActionButtonEnabled("groupsEdit",!1),setActionButtonEnabled("quotasEdit",!1)):($("#cancel").html("ZZOPEN echo Localization::getJSString(QUOTEbutton.backQUOTE)ZZCLOSE"),setActionButtonEnabled("saveNew",!1),setActionButtonEnabled("saveEdit",!1),setActionButtonEnabled("groupsEdit",!0),setActionButtonEnabled("quotasEdit",
!0))}function deleteUserGroup(a,b,c){confirm("ZZOPEN echo Localization::getJSString(QUOTEuser.deleteGroup.confirmQUOTE)ZZCLOSE "+b+"?")&&$.ajax({url:c+"/"+a,dataType:"json",type:"DELETE",success:startDisplayUserGroupsForCurrentUser,error:displayErrorV2})}
function addGroupToUser(a){grps=document.getElementById("availableGroupsList");for(i=selectedCount=0;i<grps.options.length;i++)grps.options[i].selected&&selectedCount++;currentItem=1;for(i=0;i<grps.options.length;i++)grps.options[i].selected&&(currentItem==selectedCount?onSuccess=startDisplayUserGroupsForCurrentUser:onSusccess=null,$.ajax({url:a+"/"+grps.options[i].value,dataType:"json",type:"POST",data:null,success:startDisplayUserGroupsForCurrentUser,error:displayErrorV2}),currentItem++);startDisplayUserGroups(a)}
function addUser(){$.get("resources/templates/userAdd.php",function(a){currentServiceGroup=currentService=null;$("#content").html(a.replaceAll("{userNameAsLabel}","").replaceAll("{userNameInputType}","text").replaceAll("{userName}","").replaceAll("{password}","").replaceAll("{firstName}","").replaceAll("{lastName}","").replaceAll("{entity}","").replaceAll("{emailAddress}","").replaceAll("{endDate}",""));$("#userEndDate").datepicker();$("#lastTokenLogin").hide();$("#lastTokenLoginLabel").hide();setUserModified(!1)})}
function saveNewUser(){saveOrUpdateUser("POST")}function updateUser(a){saveOrUpdateUser("PUT")}
function saveOrUpdateUser(a){currentUserUri="users/"+encodeURIComponent(document.getElementById("userName").value);password="password="+encodeURIComponent(document.getElementById("userPass").value);userName="userName="+encodeURIComponent(document.getElementById("userName").value);email="email="+encodeURIComponent(document.getElementById("userMail").value);firstName="firstName="+encodeURIComponent(document.getElementById("firstName").value);lastName="lastName="+encodeURIComponent(document.getElementById("lastName").value);
entity="entity="+encodeURIComponent(document.getElementById("entity").value);try{d=Date.parseExact(document.getElementById("userEndDate").value,"ZZOPEN echo Localization::getJSString(QUOTEdate.format.parseexactQUOTE)ZZCLOSE"),d.setHours(12),endDate="endDate="+encodeURIComponent(d.format("isoUtcDateTime"))}catch(b){endDate="endDate="}user={userName:$("#userName").val(),password:$("#userPass").val(),email:$("#userMail").val(),firstName:$("#firstName").val(),lastName:$("#lastName").val(),entity:$("#entity").val(),
properties:[]};for(i=0;i<propertiesCount;i++)void 0!==$("#propertyName_"+i).val()&&void 0!==$("#propertyValue_"+i).val()&&(prop={name:$("#propertyName_"+i).val(),value:$("#propertyValue_"+i).val()},user.properties.push(prop));postData=password+"&"+email+"&"+endDate+"&"+firstName+"&"+lastName+"&"+entity;"POST"==a?(uri="users/",postData="userName="+encodeURIComponent(document.getElementById("userName").value)+"&"+postData):uri="users/"+encodeURIComponent(document.getElementById("userName").value);$.ajax({url:uri,
dataType:"json",contentType:"application/json",type:a,data:JSON.stringify(user),success:startEditCurrentUser,error:displayErrorV2})}function startEditUser(a){currentUserUri=a;$.getJSON(a,editUser).error(displayErrorV2)}function startEditCurrentUser(){startEditUser(currentUserUri)}function startDisplayAvailableGroups(a){currentUserURI=a;$.getJSON(a+"/groups/available/",displayAvailableGroups).error(displayErrorV2)}
function startDisplayUserGroupsForCurrentUser(a){startDisplayUserGroups(currentUserURI)}function startDisplayUserGroups(a){currentUserURI=a;$.getJSON(a+"/groups/",displayUserGroups).error(displayErrorV2)}function startDisplayUserQuotas(a){currentUserURI=a;$.getJSON(a+"/quotas/",displayUserQuotas).error(displayErrorV2)}function startDisplayUserQuotasForCurrentUser(){startDisplayUserQuotas(currentUserUri)}
function displayAvailableGroups(a){0<a.length?$.each(a,function(a,c){$("#availableGroupsList").append($("<option>",{value:"groups/"+c.groupName,text:c.groupName}))}):$("#addGroups").hide()}
function addUserProperty(){if(""!=$("#propertyName_new").val()&&""!=$("#propertyValue_new").val()){for(i=0;i<propertiesCount;i++)if($("#propertyName_"+i).val()==$("#propertyName_new").val())return alert("ZZOPEN echo Localization::getJSString(QUOTEuser.property.existsQUOTE)ZZCLOSE"),!1;table=document.getElementById("data");rowPattern=document.getElementById("rowTpl");newRow=rowPattern.cloneNode(!0);newRow.removeAttribute("id");newRow.setAttribute("id","property_"+propertiesCount);newRow.removeAttribute("style");
newRow.className=newRow.className+" tabular_table_body"+propertiesCount%2;newRow.innerHTML=newRow.innerHTML.replaceAll("{i}",propertiesCount).replaceAll("{propertiesList[i].name}",$("#propertyName_new").val()).replaceAll("{propertiesList[i].value}",$("#propertyValue_new").val());table.insertBefore(newRow,document.getElementById("newProp"));$("#propertyValue_new").val("");$("#propertyName_new").val("");propertiesCount++;setUserModified(!0)}}
function deleteUserProperty(a,b){confirm("ZZOPEN echo Localization::getJSString(QUOTEuser.property.delete.confirmQUOTE)ZZCLOSE "+b+"?")&&(prop=document.getElementById("property_"+a),prop.parentNode.removeChild(prop),setUserModified(!0))}
function editUser(a){$.get("resources/templates/userEdit.php",function(b){null!==a.endDate?(userDate=new Date(a.endDate),dateFormated=userDate.format("ZZOPEN echo Localization::getJSString(QUOTEdate.formatQUOTE)ZZCLOSE")):dateFormated="";null!=a.lastTokenLogin?(loginDate=new Date(a.lastTokenLogin),lastTokenLogin=loginDate.format("ZZOPEN echo Localization::getJSString(QUOTEdate.format.parseexact.longQUOTE)ZZCLOSE")):lastTokenLogin="";currentUser=a;$("#content").html(b.replaceAll("{userNameAsLabel}",
a.userName).replaceAll("{userNameInputType}","hidden").replaceAll("{userName}",a.userName).replaceAll("{password}",a.password).replaceAll("{firstName}",a.firstName).replaceAll("{lastName}",a.lastName).replaceAll("{entity}",a.entity).replaceAll("{emailAddress}",a.emailAddress).replaceAll("{endDate}",dateFormated).replaceAll("{lastTokenLogin}",lastTokenLogin).replaceAll("{uri}",a.uri));if(0<a.properties.length)for(i=0;i<a.properties.length;i++)table=document.getElementById("data"),rowPattern=document.getElementById("rowTpl"),
newRow=rowPattern.cloneNode(!0),newRow.removeAttribute("id"),newRow.setAttribute("id","property_"+i),newRow.removeAttribute("style"),newRow.className=newRow.className+" tabular_table_body"+i%2,newRow.innerHTML=newRow.innerHTML.replaceAll("{i}",i).replaceAll("{propertiesList[i].name}",a.properties[i].name).replaceAll("{propertiesList[i].value}",a.properties[i].value),table.insertBefore(newRow,document.getElementById("newProp"));propertiesCount=a.properties.length;$("#userEndDate").datepicker();setUserModified(!1)})}
function displayUserGroups(a){$.get("resources/templates/userGroups.php",function(b){$("#content").html(b.replaceAll("{currentUser.userName}",currentUser.userName).replaceAll("{currentUser.uri}",currentUser.uri));table=document.getElementById("data");rowPattern=document.getElementById("rowTpl");table.removeChild(rowPattern);if(0<a.length)for(i=0;i<a.length;i++)newRow=rowPattern.cloneNode(!0),newRow.removeAttribute("id"),newRow.removeAttribute("style"),newRow.className=newRow.className+" tabular_table_body"+
i%2,newRow.innerHTML=newRow.innerHTML.replaceAll("{groupList[i].groupName}",a[i].groupName).replaceAll("{currentUserURI}",currentUserURI).replaceAll("{groupList[i].description}",a[i].description),table.appendChild(newRow),edit=document.getElementById("btnEdit"),del=document.getElementById("btnDelete"),"Admin"==a[i].groupName&&"Admin"==currentUser.userName?del.remove():del.removeAttribute("id");else $("#userGroupList").hide();startDisplayAvailableGroups(currentUserURI)})}
function displayUserQuotas(a){$.get("resources/templates/userQuotas.php",function(b){$("#content").html(b.replaceAll("{currentUser.userName}",currentUser.userName));table=document.getElementById("data");rowPattern=document.getElementById("rowTpl");table.removeChild(rowPattern);if(0<a.length)for(i=0;i<a.length;i++)newRow=rowPattern.cloneNode(!0),newRow.removeAttribute("id"),newRow.removeAttribute("style"),newRow.className=newRow.className+" tabular_table_body"+i%2,newRow.innerHTML=newRow.innerHTML.replaceAll("{quotasList[i].serviceName}",
a[i].serviceName).replaceAll("{quotasList[i].reqSec}",a[i].reqSec).replaceAll("{quotasList[i].reqDay}",a[i].reqDay).replaceAll("{quotasList[i].reqMonth}",a[i].reqMonth).replaceAll("{quotasList[i].uri}",a[i].uri),table.appendChild(newRow),edit=document.getElementById("btnEdit"),del=document.getElementById("btnDelete"),del.removeAttribute("id"),edit.removeAttribute("id");else $("#userQuotasList").hide()})}function handelUserFilterFormKeypress(a){if(13==a.keyCode)return showUsers(),!1}
function displayUserList(a){$.get("resources/templates/userList.php",function(b){$("#content").html(b.replaceAll("{userList.length}",a.length).replaceAll("{userNameFilterPrevVal}",userNameFilterPrevVal).replaceAll("{emailAddressFilterPrevVal}",emailAddressFilterPrevVal).replaceAll("{entityFilterPrevVal}",entityFilterPrevVal).replaceAll("{firstNameFilterPrevVal}",firstNameFilterPrevVal).replaceAll("{lastNameFilterPrevVal}",lastNameFilterPrevVal));table=document.getElementById("data");rowPattern=document.getElementById("rowTpl");
table.removeChild(rowPattern);b=[];var c=[],e=[],f=[],g=[];for(i=0;i<a.length;i++){if(null!==a[i].endDate){var h=new Date;h.setISO8601(a[i].endDate);dateFormated=h.format("ZZOPEN echo Localization::getJSString(QUOTEdate.formatQUOTE)ZZCLOSE")}else dateFormated="";addItem(b,a[i].userName);addItem(c,a[i].emailAddress,!0);addItem(e,a[i].entity,!0);addItem(f,a[i].firstName,!0);addItem(g,a[i].lastName,!0);newRow=rowPattern.cloneNode(!0);newRow.removeAttribute("id");newRow.removeAttribute("style");newRow.className=
newRow.className+" tabular_table_body"+i%2;newRow.innerHTML=newRow.innerHTML.replaceAll("{userList[i].userName}",a[i].userName).replaceAll("{userList[i].emailAddress}",a[i].emailAddress).replaceAll("{userList[i].uri}",a[i].uri).replaceAll("{userList[i].endDate}",dateFormated);table.appendChild(newRow);edit=document.getElementById("btnEdit");del=document.getElementById("btnDelete");"Admin"===a[i].userName?del.remove():del.removeAttribute("id");edit.removeAttribute("id")}0==a.length&&$("#usersList").hide();
$("#userNameFilter").autocomplete({source:b,minLength:0});$("#emailAddressFilter").autocomplete({source:c,minLength:0});$("#entityFilter").autocomplete({source:e,minLength:0});$("#firstNameFilter").autocomplete({source:f,minLength:0});$("#lastNameFilter").autocomplete({source:g,minLength:0})})}function deleteUser(a,b){confirm("ZZOPEN echo Localization::getJSString(QUOTEuser.delete.confirmQUOTE)ZZCLOSE "+b+"?")&&$.ajax({url:a,dataType:"json",type:"DELETE",success:showUsers,error:displayErrorV2})}
function resetUserFilter(){$("#userNameFilter").val("");$("#firstNameFilter").val("");$("#lastNameFilter").val("");$("#emailAddressFilter").val("");$("#entityFilter").val("");showUsers()}
function showUsers(){prms="order=userName";prms=prms+"&userNameFilter="+encodeURIComponent(getFilterValue("userNameFilter"));prms=prms+"&firstNameFilter="+encodeURIComponent(getFilterValue("firstNameFilter"));prms=prms+"&lastNameFilter="+encodeURIComponent(getFilterValue("lastNameFilter"));prms=prms+"&emailAddressFilter="+encodeURIComponent(getFilterValue("emailAddressFilter"));prms=prms+"&entityFilter="+encodeURIComponent(getFilterValue("entityFilter"));$.ajax({url:"./users/",dataType:"json",type:"GET",
data:prms,success:displayUserList,error:displayErrorV2})}$(function(){$("#listUser").click(resetUserFilter);$("#addUser").click(addUser)});
