var groupModified,groupNameFilterPrevVal="",groupDescritpionFilterPrevVal="",currentGroup;function resetGroupFilter(){groupDescritpionFilterPrevVal=groupNameFilterPrevVal="";$("#groupNameFilter").val("");$("#groupDescritpionFilter").val("");showGroups()}function handelGroupFilterFormKeypress(a){if(13==a.keyCode)return showGroups(),!1}
function setGroupModified(a){(groupModified=a)?(setActionButtonEnabled("saveGroup",!0),setActionButtonEnabled("groupMembers",!1)):(setActionButtonEnabled("saveGroup",!1),setActionButtonEnabled("groupMembers",!0))}function startEditGroup(a){$.getJSON(a,editGroup).error(displayErrorV2)}function updateGroup(a){desc="description="+encodeURIComponent(document.getElementById("groupDesc").value);$.ajax({url:a+"?"+desc,dataType:"json",type:"PUT",data:desc,success:showGroups,error:displayErrorV2})}
function editGroup(a){currentGroup=a;$.get("resources/templates/groupEdit.php",function(b){$("#content").html(b.replaceAll("{group.groupName}",a.groupName).replaceAll("{group.description}",a.description).replaceAll("{group.uri}",a.uri).replaceAll("{groupNameInputType}","hidden"));setGroupModified(!1)})}
function saveNewGroup(){desc="description="+encodeURIComponent(document.getElementById("groupDesc").value);groupName="groupName="+encodeURIComponent(document.getElementById("groupName").value);$.ajax({url:"groups/?"+desc+"&"+groupName,dataType:"json",type:"POST",data:desc,success:showGroups,error:displayErrorV2})}
function addGroup(){$.get("resources/templates/groupAdd.php",function(a){$("#content").html(a.replaceAll("{groupNameInputType}","text").replaceAll("{group.groupName}","").replaceAll("{group.description}",""));setGroupModified(!1)})}
function displayGroupList(a){$.get("resources/templates/groupList.php",function(b){$("#content").html(b.replaceAll("{groupList.length}",a.length).replaceAll("{groupNameFilterPrevVal}",groupNameFilterPrevVal).replaceAll("{groupDescritpionFilterPrevVal}",groupDescritpionFilterPrevVal));table=document.getElementById("data");rowPattern=document.getElementById("rowTpl");table.removeChild(rowPattern);b=[];var c=[];for(i=0;i<a.length;i++)addItem(b,a[i].groupName,!0),addItem(c,a[i].description,!0),newRow=
rowPattern.cloneNode(!0),newRow.removeAttribute("id"),newRow.removeAttribute("style"),newRow.className=newRow.className+" tabular_table_body"+i%2,newRow.innerHTML=newRow.innerHTML.replaceAll("{groupList[i].groupName}",a[i].groupName).replaceAll("{groupList[i].description}",a[i].description).replaceAll("{groupList[i].uri}",a[i].uri),table.appendChild(newRow),edit=document.getElementById("btnEdit"),del=document.getElementById("btnDelete"),"Admin"==a[i].groupName||"valid-user"==a[i].groupName?del.remove():
del.removeAttribute("id"),edit.removeAttribute("id");$("#groupNameFilter").autocomplete({source:b,minLength:0});$("#groupDescritpionFilter").autocomplete({source:c,minLength:0});setGroupModified(!1)})}function deleteGroup(a,b){confirm("<?php echo Localization::getJSString("group.delete.confirm")?> "+b+"?")&&$.ajax({url:a,dataType:"json",type:"DELETE",success:showGroups,error:displayErrorV2})}
function showGroups(){prms="order=groupName";prms=prms+"&groupNameFilter="+encodeURIComponent(getFilterValue("groupNameFilter"));prms=prms+"&groupDescritpionFilter="+encodeURIComponent(getFilterValue("groupDescritpionFilter"));$.ajax({url:"./groups/",dataType:"json",type:"GET",data:prms,success:displayGroupList,error:displayErrorV2})}
function displayGroupMembers(a){$.get("resources/templates/groupMembers.php",function(b){$("#content").html(b.replaceAll("{currentGroup.groupName}",currentGroup.groupName));table=document.getElementById("data");rowPattern=document.getElementById("rowTpl");table.removeChild(rowPattern);for(i=0;i<a.length;i++)newRow=rowPattern.cloneNode(!0),newRow.removeAttribute("id"),newRow.removeAttribute("style"),newRow.className=newRow.className+" tabular_table_body"+i%2,newRow.innerHTML=newRow.innerHTML.replaceAll("{userList[i].userName}",
a[i].userName).replaceAll("{userList[i].firstName}",a[i].firstName).replaceAll("{userList[i].lastName}",a[i].lastName).replaceAll("{userList[i].emailAddress}",a[i].emailAddress),table.appendChild(newRow)})}function showMembers(){$.ajax({url:currentGroup.uri+"/members",dataType:"json",type:"GET",data:"order=userName",success:displayGroupMembers,error:displayErrorV2})}$(function(){$("#listGroup").click(resetGroupFilter);$("#addGroup").click(addGroup)});
