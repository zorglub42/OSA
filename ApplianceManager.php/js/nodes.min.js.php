var currentNode,nodeModified,removeSSLSetting=!1,removeCASSLSetting=!1,servicesLoaded=!1,nodeNameFilterPrevVal="",nodeDescriptionFilterPrevVal="",localIPFilterPrevVal="",portFilterPrevVal="",serverFQDNFilterPrevVal="";
function setNodeModified(a){(nodeModified=a)?setActionButtonEnabled("saveNode",!0):setActionButtonEnabled("saveNode",!1);$("#isHTTPS").is(":checked")?$("#tabs").tabs("enable",1):$("#tabs").tabs("disable",1);""!=$("#additionalConfiguration").val()?$("#warnAdditionalConfig").show():$("#warnAdditionalConfig").hide()}function startEditNode(a){$.getJSON(a,editNode).error(displayErrorV2)}function updateNode(a){saveOrUpdateNode("PUT")}
function startResetCASSL(){confirm("<?php echo Localization::getJSString("node.deleteCASSL.confirm")?>")&&(removeCASSLSetting=!0,setNodeModified(!0),clearFileInput("CHAINfileuploadFLD"))}function startResetSSL(){confirm("<?php echo Localization::getJSString("node.deleteSSL.confirm")?>")&&(removeSSLSetting=!0,setNodeModified(!0),clearFileInput("PKfileuploadFLD"),clearFileInput("CERTfileuploadFLD"))}
function loadNodeServices(a){servicesLoaded||(showWait(),$.getJSON(a+"/services/",displayNodeServices).error(displayErrorV2))}
function displayNodeServices(a){hideWait();table=document.getElementById("data");rowPattern=document.getElementById("rowTpl");table.removeChild(rowPattern);$("#serviceListTitle").html($("#serviceListTitle").html().replaceAll("{serviceList.length}",a.length));for(i=0;i<a.length;i++)cbPublishedCheck=1==a[i].isPublished?"checked":"",newRow=rowPattern.cloneNode(!0),newRow.removeAttribute("id"),newRow.removeAttribute("style"),newRow.className=newRow.className+" tabular_table_body"+i%2,newRow.innerHTML=
newRow.innerHTML.replaceAll("{serviceList[i].serviceName}",a[i].serviceName).replaceAll("{servicelist[i].cbpublishedcheck}",cbPublishedCheck).replaceAll("{i}",i).replaceAll("{serviceList[i].groupName}",a[i].groupName).replaceAll("{serviceList[i].frontEndEndPoint}",a[i].frontEndEndPoint).replaceAll("{serviceList[i].backEndEndPoint}",a[i].backEndEndPoint),table.appendChild(newRow);0==a.length&&$("#servicesList").hide();servicesLoaded=!0}
function clearFileInput(a){a=document.getElementById(a);var b=document.createElement("input");b.type="file";b.id=a.id;b.name=a.name;b.className=a.className;b.style.cssText=a.style.cssText;a.parentNode.replaceChild(b,a)}function toggleAuthority(){$("#sslAuthority").toggle();$("#manageCaCert").is(":checked")||clearFileInput("CHAINfileuploadFLD")}
function editNode(a){$.get("resources/templates/nodeEdit.php",function(b){servicesLoaded=!1;cbIsHTTPS=cbIsCookieAuthEnabled=cbIsBasicAuthEnabled="checked";cbManageCAEnabled="";0==a.isCookieAuthEnabled&&(cbIsCookieAuthEnabled="");0==a.isBasicAuthEnabled&&(cbIsBasicAuthEnabled="");0==a.isHTTPS&&(cbIsHTTPS="");if(""!=a.caUri||""!=a.chainUri)cbManageCAEnabled="checked";currentNode=a;$("#content").html(b.replaceAll("{node.uri}",a.uri).replaceAll("{node.additionalConfiguration}",a.additionalConfiguration).replaceAll("{nodeNameAsLabel}",
a.nodeName).replaceAll("{nodeNameInputType}","hidden").replaceAll("{node.nodeName}",a.nodeName).replaceAll("{cbIsHTTPS}",cbIsHTTPS).replaceAll("{node.localIP}",a.localIP).replaceAll("{node.port}",a.port).replaceAll("{node.serverFQDN}",a.serverFQDN).replaceAll("{node.nodeDescription}",a.nodeDescription).replaceAll("{cbIsBasicAuthEnabled}",cbIsBasicAuthEnabled).replaceAll("{cbIsCookieAuthEnabled}",cbIsCookieAuthEnabled).replaceAll("{cbManageCAEnabled}",cbManageCAEnabled));""==a.caUri&&""==a.chainUri&&
$("#sslAuthority").hide();$(function(){$("#tabs").tabs()});$("#mainForm").height($("#tabs").height()+10);$("#mainForm").click(function(){$("#mainForm").height($("#tabs").height()+10)});setNodeModified(!1);removeCASSLSetting=removeSSLSetting=!1})}
function saveOrUpdateNode(a){if(!$("#isCookieAuthEnabled").is(":checked")&&!$("#isBasicAuthEnabled").is(":checked"))return alert("<?php echo Localization::getJSString("node.no-authent-warning")?>"),!1;if("80"==$("#port").val()&&document.getElementById("isHTTPS").checked&&!confirm("<?php echo Localization::getJSString("node.https-on-80-warning")?>")||"443"==$("#port").val()&&!document.getElementById("isHTTPS").checked&&!confirm("<?php echo Localization::getJSString("node.http-on-443-warning")?>"))return!1;
showWait();var b=document.getElementById("PKfileuploadFLD"),d=document.getElementById("CERTfileuploadFLD"),e=document.getElementById("CHAINfileuploadFLD");del=!0;removeSSLSetting&&0==b.files.length&&0==d.files.length&&(del=!1,$.ajax({url:"nodes/"+currentNode.nodeName+"/cert",dataType:"json",async:!1,type:"DELETE",success:function(a){del=!0},error:displayErrorV2}),del&&(del=!1,$.ajax({url:"nodes/"+currentNode.nodeName+"/privateKey",dataType:"json",type:"DELETE",async:!1,success:function(a){del=!0},
error:displayErrorV2})));removeCASSLSetting&&0==e.files.length&&del&&(del=!1,$.ajax({url:"nodes/"+currentNode.nodeName+"/chain",dataType:"json",type:"DELETE",async:!1,success:function(a){del=!0},error:displayErrorV2}));if(!del)return hideWait(),!1;nodeName="nodeName="+encodeURIComponent($("#nodeNameFld").val());localIP="localIP="+encodeURIComponent(document.getElementById("localIP").value);port="port="+encodeURIComponent(document.getElementById("port").value);nodeDescription="nodeDescription="+encodeURIComponent(document.getElementById("nodeDescription").value);
additionalConfiguration="additionalConfiguration="+encodeURIComponent($("#additionalConfiguration").val());serverFQDN="serverFQDN="+encodeURIComponent(document.getElementById("serverFQDN").value);isHTTPS=document.getElementById("isHTTPS").checked?"isHTTPS=1":"isHTTPS=0";isBasicAuthEnabled=document.getElementById("isBasicAuthEnabled").checked?"isBasicAuthEnabled=1":"isBasicAuthEnabled=0";isCookieAuthEnabled=document.getElementById("isCookieAuthEnabled").checked?"isCookieAuthEnabled=1":"isCookieAuthEnabled=0";
postData=localIP+"&"+serverFQDN+"&"+port+"&"+isBasicAuthEnabled+"&"+isCookieAuthEnabled+"&"+nodeDescription+"&"+additionalConfiguration+"&"+isHTTPS;"PUT"==a?businessUrl="nodes/"+encodeURIComponent(document.getElementById("nodeNameFld").value):(businessUrl="nodes/",postData="nodeName="+encodeURIComponent(document.getElementById("nodeNameFld").value)+"&"+postData);if("POST"==a&&(postOk=!1,$.ajax({url:businessUrl,dataType:"json",type:a,data:postData+"&apply=0",async:!1,success:function(){postOk=!0},
error:displayErrorV2}),!postOk))return!1;ssl=error=!1;nodeURI="nodes/"+encodeURIComponent(document.getElementById("nodeNameFld").value);0<b.files.length&&($("#fileupload").fileupload(),$("#fileupload").fileupload("send",{async:!1,files:b.files,url:nodeURI+"/privateKey"}).error(function(a,b,c){error=error||!0;$("#fileupload").fileupload("destroy");displayErrorV2(a,b,c)}),ssl=!0,$("#fileupload").fileupload("destroy"));0<d.files.length&&($("#fileupload").fileupload(),$("#fileupload").fileupload("send",
{async:!1,files:d.files,url:nodeURI+"/cert"}).error(function(a,b,c){error=error||!0;$("#fileupload").fileupload("destroy");displayErrorV2(a,b,c)}),ssl=!0,$("#fileupload").fileupload("destroy"));0<e.files.length&&($("#fileupload").fileupload(),$("#fileupload").fileupload("send",{async:!1,files:e.files,url:nodeURI+"/chain"}).error(function(a,b,c){error=error||!0;$("#fileupload").fileupload("destroy");displayErrorV2(a,b,c)}),ssl=!0,$("#fileupload").fileupload("destroy"));if(error)return!1;$.ajax({url:businessUrl,
dataType:"json",type:"PUT",data:postData,success:showNodes,error:displayErrorV2})}function saveNewNode(){saveOrUpdateNode("POST")}
function addNode(){$.get("resources/templates/nodeAdd.php",function(a){currentNode=null;$("#content").html(a.replaceAll("{node.uri}","").replaceAll("{node.additionalConfiguration}","").replaceAll("{nodeNameAsLabel}","").replaceAll("{nodeNameInputType}","text").replaceAll("{node.nodeName}","").replaceAll("{cbIsHTTPS}","").replaceAll("{node.localIP}","").replaceAll("{node.port}","").replaceAll("{node.serverFQDN}","").replaceAll("{node.nodeDescription}","").replaceAll("{cbIsBasicAuthEnabled}","").replaceAll("{cbIsCookieAuthEnabled}",
"").replaceAll("{cbManageCAEnabled}","").replaceAll("{lblChain}",""));$("#sslAuthority").hide();$("#showServices").hide();$("#resetSSL").hide();$("#resetCASSL").hide();$(function(){$("#tabs").tabs()});$("#mainForm").height($("#tabs").height()+10);$("#mainForm").click(function(){$("#mainForm").height($("#tabs").height()+10)});setNodeModified(!1);removeCASSLSetting=removeSSLSetting=!1})}function handelNodeFilterFormKeypress(a){if(13==a.keyCode)return showNodes(),!1}
function displayNodeList(a){hideWait();$.get("resources/templates/nodeList.php",function(b){$("#content").html(b.replaceAll("{nodeList.length}",a.length).replaceAll("{nodeNameFilterPrevVal}",nodeNameFilterPrevVal).replaceAll("{nodeDescriptionFilterPrevVal}",nodeDescriptionFilterPrevVal).replaceAll("{serverFQDNFilterPrevVal}",serverFQDNFilterPrevVal).replaceAll("{localIPFilterPrevVal}",localIPFilterPrevVal).replaceAll("{portFilterPrevVal}",portFilterPrevVal));table=document.getElementById("data");
rowPattern=document.getElementById("rowTpl");table.removeChild(rowPattern);for(i=0;i<a.length;i++)cbIsHTTPS=1==a[i].isHTTPS?"checked":"",newRow=rowPattern.cloneNode(!0),newRow.removeAttribute("id"),newRow.removeAttribute("style"),newRow.className=newRow.className+" tabular_table_body"+i%2,newRow.innerHTML=newRow.innerHTML.replaceAll("{nodeList[i].nodeName}",a[i].nodeName).replaceAll("{rowParity}",i%2).replaceAll("{i}",i).replaceAll("{cbishttps}",cbIsHTTPS).replaceAll("{nodeList[i].serverFQDN}",a[i].serverFQDN).replaceAll("{nodeList[i].localIP}",
a[i].localIP).replaceAll("{nodeList[i].port}",a[i].port).replaceAll("{nodeList[i].nodeDescription}",a[i].nodeDescription).replaceAll("{nodeList[i].uri}",a[i].uri),table.appendChild(newRow),edit=document.getElementById("btnEdit"),del=document.getElementById("btnDelete"),del.removeAttribute("id"),edit.removeAttribute("id"),publish=document.getElementById("btnPublish"),unpublish=document.getElementById("btnUnpublish"),1==a[i].isPublished?(publish.remove(),unpublish.removeAttribute("id")):(unpublish.remove(),
publish.removeAttribute("id"));0==a.length&&$("#nodesList").hide()})}function deleteNode(a,b){confirm("<?php echo Localization::getJSString("node.delete.confirm")?> "+b+"?")&&(showWait(),$.ajax({url:a,dataType:"json",type:"DELETE",success:showNodes,error:displayErrorV2}))}function publishNode(a,b){showWait();$.ajax({url:a+"/status",dataType:"json",type:"POST",data:"published="+b,success:showNodes,error:displayErrorV2})}
function resetNodeFilter(){$("#nodeNameFilter").val("");$("#nodeDescriptionFilter").val("");$("#localIPFilter").val("");$("#portFilter").val("");$("#serverFQDNFilter").val("");showNodes()}
function showNodes(){prms="order=nodeName";prms=prms+"&nodeNameFilter="+encodeURIComponent(getFilterValue("nodeNameFilter"));prms=prms+"&nodeDescriptionFilter="+encodeURIComponent(getFilterValue("nodeDescriptionFilter"));prms=prms+"&localIPFilter="+encodeURIComponent(getFilterValue("localIPFilter"));""!=getFilterValue("portFilter")&&(prms=prms+"&portFilter="+encodeURIComponent(getFilterValue("portFilter")));prms=prms+"&serverFQDNFilter="+encodeURIComponent(getFilterValue("serverFQDNFilter"));$.ajax({url:"./nodes/",
dataType:"json",type:"GET",data:prms,success:displayNodeList,error:displayErrorV2})}$(function(){$("#listNode").click(resetNodeFilter);$("#addNode").click(addNode)});
